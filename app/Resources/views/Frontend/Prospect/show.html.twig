{% extends '::base.html.twig' %}
{% import ":Frontend/Macros/Prospect:photoDisplay250px.html.twig" as photoDisplay %}

{% block title %}{{ prospect.firstname }}{% endblock %}

{% form_theme delete_form _self %}

{% block button_widget %}
    {% set attr = attr|merge({class: (attr.class|default('btn-default') ~ ' btn')|trim}) %}
    {%- if label is empty -%}
        {%- if label_format is not empty -%}
            {% set label = label_format|replace({
                '%name%': name,
                '%id%': id,
            }) %}
        {%- else -%}
            {% set label = name|humanize %}
        {%- endif -%}
    {%- endif -%}
    <button type="{{ type|default('button') }}" {{ block('button_attributes') }}>{{ label|trans({}, translation_domain)|raw }}</button>    
{% endblock %}


{% block content %}    
    <div class="container">  
        {#<div class="page-nav">            
            <a class="btn-basic" href="{{ path('prospect_list') }}" title="Back to contacts">Back to contacts</a>
        </div>#}  
        
        <div id="contact-left-column">
            <a href="{{ path('gallery', {'prospect_id': prospect.id}) }}" title="Add and remove photos">
                <div id="photo-contact">
                    {{ photoDisplay.primaryPhoto(prospect.photos) }}
                    <div id="photo-mask"><div class="tilecontent">Gallery</div></div>
                </div>
            </a>
            
            {% if prospect.job %}
                <p class="job">
                    {{ prospect.job }}
                </p>
            {% endif %}
            {% if prospect.cellNumber %}
                <p class="job">
                    {{ prospect.cellNumber }}
                </p>
            {% endif %}
            {% if prospect.homeNumber %}
                <p class="job">
                    {{ prospect.homeNumber }}
                </p>
            {% endif %}
            <div class="row-age">
                <div id="age" class="tile">
                    <div class="tilecontent">
                        <p class="tile-value">{% if prospect.age %}<span>0</span>{% else %}?{% endif %}</p>
                        <p class="tile-title">Age</p>
                    </div>
                </div>
                <div id="source" class="tile">
                    <div class="tilecontent">
                       <p class="tile-value">{% if prospect.source == 'IRL (In Real Life)' %}IRL{% else %}{{ prospect.source }}{% endif %}</p>
                       <p class="tile-title">Source</p>
                    </div>
                </div>
            </div>
            <div class="row-astro">
                <div id="astro">
                    {% if prospect.zodiac %}
                    <p class="zodiac" title="{{ prospect.zodiac.wording }}">
                        {{ prospect.zodiac.letter }}
                    </p>
                    {% else %}
                        <p class="tile-value">?</p>
                    {% endif %}
                    <p class="tile-title">Astro</p>
                </div>
                {% if prospect.relationship.status == 1 %}
                    <div id="status-ok" class="tile">
                        <div class="tilecontent">
                            <p class="tile-value">Ok</p>
                            <p class="tile-title">Relationship<br>status</p>
                        </div>
                    </div>
                {% else %}
                    <div id="status-off" class="tile">
                        <div class="tilecontent">
                            <p class="tile-value">Over</p>
                            <p class="tile-title">Relationship<br>status</p>
                        </div>
                    </div>
                {% endif %}
            </div>
            <div class="row-neutral">
            </div>
        </div><!--
     --><div id="contact-right-column">
            <a id="edit_prospect" href="#" title="Edit contact">
                <div id="basic-infos-container">
                    <div id="basic-infos">
                        <p id="name">
                            {{ prospect.firstname }} {{ prospect.lastname }}
                            {% if prospect.country != null %}
                                {% set lang = prospect.country|upper %}
                                <img src="{{ asset('bundles/app/images/flags/' ~ lang ~ '.png') }}" />
                            {% endif %}
                        </p>
                        <p id="adress">
                            {{ prospect.address }} {{ prospect.zipcode }} {{ prospect.city|upper }}
                        </p>
                    </div>
                    <div id="mask-basic-infos"><div class="tilecontent">Edit contact infos</div></div>
                </div>                
            </a>        
            <div class="row row-bigtiles">
                <a id="rating-link" data-id="{{ prospect.rating.id }}" href="#">
                    <div class="col-md-4 bigtile-rating border-right">
                        <div class="tilecontent">
                            <div class="rating-container">
                                <div class="bigtile-title">
                                    Average rating <div class="rating-avg" title="Average rating<br>for this contact" data-rating="{{ prospect.rating.average }}"></div>
                                </div>
                                <div id="averagecircle" data-percent="{{ prospect.rating.percentAverage }}" class="orange"></div>
                            </div>                            
                        </div>
                        <div class="mask-rating"><div class="tilecontent">Edit ratings</div></div>
                    </div>
                </a>
                <div class="col-md-4 bigtile border-right">
                    <div class="tilecontent">
                        <p class="bigtile-title">Red flags</p>
                    </div>
                </div>
                <div class="col-md-4 bigtile">
                    <div class="tilecontent">
                        <p class="bigtile-title"></p>
                    </div>
                </div>
            </div>                   
                    
            <div class="row row-bigtiles">
                <a class="edit-relationship" data-id="{{ prospect.relationship.id }}" href="#" title="Edit relationship">                    
                    <div class="col-md-4 bigtile-relationship">                        
                        <div class="tilecontent">
                            <div class="bigtile-relationship-container">
                                <p class="bigtile-value">{{ prospect.relationship.relationshipRank }}</p>
                                <p class="bigtile-title">Relationship type</p>
                            </div>
                        </div>
                        <div class="mask-relationship"><div class="tilecontent">Edit relationship</div></div>
                    </div>
                </a>
                <div class="col-md-4 smalltile-container-middle">
                    <div class="row row-tiles">
                        <div class="col-md-6 smalltile" id="met">
                            <div class="tilecontent">
                                {% if  prospect.relationship.meeting %}
                                    <i class="icon ion-wineglass"></i>
                                {% else %}
                                    <i class="icon ion-android-close"></i>
                                {% endif %}
                                <p>Met</p>
                            </div>
                        </div>
                        <div class="col-md-6  smalltile" id="kc">
                            <div class="tilecontent">
                                {% if  prospect.relationship.kc %}
                                    <i class="icon ion-fireball"></i>
                                {% else %}
                                    <i class="icon ion-android-close"></i>
                                {% endif %}
                                <p>Kissed</p>
                            </div>
                        </div>
                    </div>
                    <div class="row row-tiles">
                        <div class="col-md-6 smalltile" id="start-date">
                            <div class="tilecontent">
                                {% if  prospect.relationship.startDate %}
                                    <p id="start-date-val">{{ prospect.relationship.startDate|date('d-m-Y') }}</p>
                                {% else %}
                                    <p>?</p>
                                {% endif %}
                                <p><i class="icon ion-calendar"></i> Start Date</p>
                            </div>
                        </div>
                        <div class="col-md-6 smalltile" id="meetingcount">
                            <div class="tilecontent">
                                <p class="smalltile-subtext"><span>0</span></p>
                                <p>Meeting count</p>                           
                            </div>
                        </div>
                    </div>
                </div>
                            
                <div class="col-md-4 smalltile-container-right">
                    <div class="row  row-tiles">
                        <div class="col-md-6 smalltile" id="fc">
                            <div class="tilecontent">
                                {% if  prospect.relationship.fc %}
                                    <i class="icon ion-android-cancel"></i>
                                {% else %}
                                    <i class="icon ion-android-close"></i>
                                {% endif %}
                                <p>Sex</p>
                            </div>
                        </div>
                        <div class="col-md-6 smalltile" id="distance">
                            <div class="tilecontent">
                                {% if  prospect.relationship.distance %}
                                    <i class="icon ion-sad-outline"></i>                                    
                                {% else %}
                                    <i class="icon ion-happy-outline"></i>
                                {% endif %}
                                <p>Distance</p>
                            </div>
                        </div>
                    </div>            
                    <div class="row  row-tiles">
                        <div class="col-md-6 smalltile" id="blank1">
{#                            <p class="smalltile-subtext"><span>0</span></p>#}
{#                            <p>Meeting count</p>                           #}
                        </div>
                        <div class="col-md-6 smalltile" id="blank2">
{#                            <p class="smalltile-subtext"><span>0</span></p>#}
{#                            <p>Meeting count</p>                           #}
                        </div>
                    </div>            
                </div>            
            </div>                       
                            
            <div class="row row-bigtiles">                
                <div class="col-md-4 bigtile-left bigtile">
                    
                </div>
                <div class="col-md-4 bigtile-middle bigtile">

                </div>
                <div class="col-md-4 bigtile">
                    <p class="bigtile-title"></p>
                </div>
            </div>
      
                    
                    
                    
                    
                    
        
        {#<div class="row" id="prospect-show-content">                
            <div class="col-md-3 show-left-col">
                <div>
                    {{ photoDisplay.primaryPhoto(prospect.photos) }}
                    <ul>                    
                        <li> 
                            <a id="edit_prospect" href="#" title="Edit contact">Edit contact infos</a>                
                        </li>
                    </ul>
                    <div class="prospect-show-phone">
                        {% if prospect.cellNumber %}
                            <p class="phone-info"><i class="icon ion-iphone"></i><span>{{ prospect.cellNumber }}</span></p>
                        {% endif %}
                        {% if prospect.homeNumber %}
                            <p class="phone-info"><i class="icon ion-iphone"></i><span>{{ prospect.homeNumber }}</span></p>  
                        {% endif %}
                    </div>                  
                </div>                
            </div>                
            <div class="col-md-9 show-right-col">
                <div id="prospect-info-basic">
                    <div>
                        {% if prospect.country != null %}
                            {% set lang = prospect.country|upper %}
                            <img src="{{ asset('bundles/app/images/flags/' ~ lang ~ '.png') }}" />
                        {% endif %}
                        <div id="name-age">{{ prospect.firstname }} {{ prospect.lastname }}                   
                            {% if prospect.age %}
                                , {{ prospect.age }}
                            {% endif %}
                            {% if prospect.nickname %}
                                ({{ prospect.nickname }})
                            {% endif %}
                        </div>
                    </div>                     
                </div>
                <p class="full-address">                      
                    <span>Full address:</span> {{ prospect.address }} {{ prospect.zipcode }} {{ prospect.city|capitalize }}
                </p>
                <div class="icons">
                    {% if prospect.zodiac %}
                        <div class="zodiac custom-tooltip" title="{{ prospect.zodiac.wording }}" data-toggle="tooltip" data-placement="top">
                            {{ prospect.zodiac.letter }}
                        </div>
                    {% else %}
                        <div class="icon-empty custom-tooltip" title="No zodiacal sign selected" data-toggle="tooltip" data-placement="top">
                            <i class="icon ion-ios-help-empty"></i>
                        </div>
                    {% endif %}
                    <div class="icon-separator"></div>
                    {% if prospect.relationship.meeting %}
                        <div class="icon-basic custom-tooltip" title="You have met" data-toggle="tooltip" data-placement="top">
                            <i class="icon ion-wineglass"></i>
                        </div>
                    {% else %}
                        <div class="icon-empty custom-tooltip" title="You haven't met" data-toggle="tooltip" data-placement="top">
                            <i class="icon ion-ios-help-empty"></i>
                        </div>
                    {% endif %}
                    {% if prospect.relationship.fc %}
                        <div class="icon-X custom-tooltip" title="Sex happened" data-toggle="tooltip" data-placement="top"></div>
                    {% else %}
                        <div class="icon-empty custom-tooltip" title="No sex" data-toggle="tooltip" data-placement="top">
                            <i class="icon ion-ios-help-empty"></i>
                        </div>
                    {% endif %}
                </div>
                <table class="table table-responsive" id="table-prospect-show">
                    <tbody>             
                        <tr>
                            <th>Job</th>
                            <td>{{ prospect.job }}</td>
                        </tr>
                        <tr>
                            <th>Source</th>
                            <td>{{ prospect.source }}</td>
                        </tr>                        
                    </tbody>
                </table>                             
            </div> 
            
        </div>
        <div class="show-actions">
            <ul>                  
                <li class="icon-title"><p>Gallery</p></li>
                <li>
                    <a href="{{ path('gallery', {'prospect_id': prospect.id}) }}" title="Add and remove photos"><i class="icon ion-ios-albums-outline"></i></a>
                </li>
                <li class="icon-separator"></li>
                <li class="icon-title"><p>Ratings</p></li>
                <li>
                    <a class="edit-rating" href="#" data-id="{{ prospect.rating.id }}" title="Rate this contact"><i class="icon ion-ios-star-outline"></i></a>
                </li>
                <li class="icon-separator"></li>
                <li class="icon-title"><p>Relationship</p></li>                       
                <li>
                    <a class="edit-relationship custom-tooltip" data-id="{{ prospect.relationship.id }}" href="#" title="Edit relationship" data-toggle="tooltip" data-placement="top"><i class="icon ion-ios-compose-outline"></i></a>                       
                </li>
                <li class="icon-separator"></li>
                <li class="icon-title"><p>Encounters</p></li>
                <li class="icon-add">
                    <a id="new-encounter" href="#" title="Add new encounter"><i class="icon ion-ios-plus-empty"></i></a>                    
                </li>
                <li class="icon-add">                    
                    <a id="encounters-list" href="{{ path('encounter', {'prospect_id': prospect.id}) }}" title="Encounters"><i class="icon ion-ios-list-outline"></i></a>
                </li> 
            </ul>
        </div>#}
            
        {# Modales #}
        <div class="modal fade modal-full" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg modal-dialog-scroll">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"><i class="icon ion-ios-close-empty"></i></span>
                        </button>
                        <h2 class="modal-title"></h2>
                    </div>    
                    <div class="modal-body">
                        {# Form returned by ajax #}
                    </div>                       
                </div>    
            </div>
        </div>                
                        
        {# POPUP OVERLAY D'ATTENTE AJAX #}
        <div class="loader_standard">
            <p>Loading...</p>
        </div>                
    </div>                            
    
    <script type="text/javascript">
        $(document).ready(function(){
            
            var age = "{{ prospect.age }}";
            $("#age span").animateNumber({ number: age }, 3000);
            var count = "{{ prospect.relationship.meetingCount }}";
            $("#meetingcount span").animateNumber({ number: count }, 2000);
            
            {#$(function(){
                $("[id$='orangecircle']").percircle();
            });#}
            
            $("#averagecircle").percircle({
                
            });
            
            var locale = "{{ app.request.locale }}";
            var id = "{{ prospect.id }}";
            
            $('[data-toggle="tooltip"]').tooltip({
                html: true
            });           
            
            // Ajax: get edit form prospect ************************************
            $("#contact-right-column").on("click", "#edit_prospect", function(event){
                event.preventDefault();
   
                $(".loader_standard").show();
                
                var url = Routing.generate('ajax_edit_prospect_form', {'id':id, '_locale': locale});
                
                $.get(url, function(response){                   
                    $(".modal-body").html(response); // coller la vue dans une modale  
                    
                    $(".loader_standard").hide(200, function(){});                                     
                    
                    $(".modal-title").text("Edit contact");
                    $('.modal-full').modal('show');
                });
            });
            
            // Ajax: get form new encounter ************************************
            $(".show-actions").on("click", "#new-encounter", function(event){
                event.preventDefault();                

                $(".loader_standard").show();

                var url = Routing.generate('ajax_new_encounter_form', {'prospect_id': id, '_locale': locale});
                
                $.get(url, function(response){                   
                    $(".modal-body").html(response); // coller la vue dans une modale  
                    
                    $(".loader_standard").hide(200, function(){});                                     
                    
                    $(".modal-title").text("New encounter");
                    $('.modal-full').modal('show');
                });
            });
            
            // Ajax: get form edit relationship ********************************
            $(".row-bigtiles").on("click", ".edit-relationship", function(event){
                event.preventDefault();               
                
                $(".loader_standard").show();
            
                var id = $(this).data("id");                
                var url = Routing.generate('ajax_edit_relationship_form', {'id':id, '_locale': locale});
                
                $.get(url, function(response){                   
                    $(".modal-body").html(response);                    
                    
                    $(".loader_standard").hide(200, function(){});                                     
                    
                    $(".modal-title").text("Edit relationship");
                    $('.modal-full').modal('show');
                });
            });
            
            // Ajax: get form edit ratings *************************************
            $(".container").on("click", ".edit-rating, #rating-link", function(event){
                event.preventDefault();               
                
                $(".loader_standard").show();
            
                var id = $(this).data("id");                
                var url = Routing.generate('ajax_edit_rating_form', {'id':id, '_locale': locale});
                
                $.get(url, function(response){                   
                    $(".modal-body").html(response);                    
                    
                    $(".loader_standard").hide(200, function(){});                                     
                    
                    $(".modal-title").text("Edit ratings");
                    $('.modal-full').modal('show');
                });
            });
            
            
            $('.modal-full').on('hidden.bs.modal', function (e) {
                $(".modal-body").empty();
                $(".modal-title").empty();
            });
            
            $(".rating-avg").each(function(index, div) {
                
                avgRating = $(div).data("rating");                
                
                $(div).starRating({
                    initialRating: avgRating,
                    totalStars: 5,                
                    starSize: 15,
                    disableAfterRate: false,
                    useGradient: false,
                    emptyColor: '#ddd',
                    hoverColor: '#F47363',
                    useFullStars: true,
                    readOnly: true
                });                
            });
        });
    </script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        'bundles/app/packages/percircle/js/percircle.js'
        'bundles/app/js/jquery.animateNumber.min.js'
    %}        
    <script src="{{ asset_url }}"></script>
    {% endjavascripts%}
{% endblock %}